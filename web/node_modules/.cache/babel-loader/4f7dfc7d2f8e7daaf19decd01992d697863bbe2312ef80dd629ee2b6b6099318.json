{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\himat\\\\OneDrive\\\\desktop\\\\aslproject\\\\webrtc-asl\\\\src\\\\VideoCall.tsx\",\n  _s2 = $RefreshSig$();\n// src/VideoCall.tsx\nimport React, { useEffect, useRef, useState } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst VideoCall = () => {\n  _s2();\n  var _s = $RefreshSig$();\n  const localVideoRef = useRef(null);\n  const remoteVideoRef = useRef(null);\n  const [peerConnection, setPeerConnection] = useState(null);\n  const ws = useRef(null);\n  _s(useEffect(_s(() => {\n    _s();\n    // Configure STUN server (using Google’s public STUN server)\n    const configuration = {\n      iceServers: [{\n        urls: 'stun:stun.l.google.com:19302'\n      }]\n    };\n\n    // Create RTCPeerConnection\n    const pc = new RTCPeerConnection(configuration);\n    setPeerConnection(pc);\n\n    // When a remote stream arrives, attach it to the remoteVideo element\n    pc.ontrack = event => {\n      if (remoteVideoRef.current) {\n        remoteVideoRef.current.srcObject = event.streams[0];\n      }\n    };\n\n    // Connect to the signaling server\n    //ws.current = new WebSocket('ws://localhost:8080');\n    useEffect(() => {\n      console.log('Creating WebSocket...');\n      ws.current = new WebSocket('ws://localhost:8080');\n      // ...\n    }, []);\n    ws.current.onmessage = async messageEvent => {\n      const data = JSON.parse(messageEvent.data);\n      if (data.offer) {\n        var _ws$current;\n        // Received an offer from a remote peer\n        await pc.setRemoteDescription(new RTCSessionDescription(data.offer));\n        const answer = await pc.createAnswer();\n        await pc.setLocalDescription(answer);\n        (_ws$current = ws.current) === null || _ws$current === void 0 ? void 0 : _ws$current.send(JSON.stringify({\n          answer\n        }));\n      } else if (data.answer) {\n        // Received answer to our offer\n        await pc.setRemoteDescription(new RTCSessionDescription(data.answer));\n      } else if (data.ice) {\n        // Received ICE candidate from remote peer\n        try {\n          await pc.addIceCandidate(data.ice);\n        } catch (e) {\n          console.error('Error adding ICE candidate', e);\n        }\n      }\n    };\n\n    // When a new ICE candidate is found, send it via signaling\n    pc.onicecandidate = event => {\n      if (event.candidate) {\n        var _ws$current2;\n        (_ws$current2 = ws.current) === null || _ws$current2 === void 0 ? void 0 : _ws$current2.send(JSON.stringify({\n          ice: event.candidate\n        }));\n      }\n    };\n\n    // Get the local media stream and add it to the peer connection\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      if (localVideoRef.current) {\n        localVideoRef.current.srcObject = stream;\n      }\n      stream.getTracks().forEach(track => {\n        pc.addTrack(track, stream);\n      });\n    }).catch(error => {\n      console.error('Error accessing media devices:', error);\n    });\n\n    // Once signaling connection is open, create an offer\n    ws.current.onopen = async () => {\n      try {\n        var _ws$current3;\n        const offer = await pc.createOffer();\n        await pc.setLocalDescription(offer);\n        (_ws$current3 = ws.current) === null || _ws$current3 === void 0 ? void 0 : _ws$current3.send(JSON.stringify({\n          offer\n        }));\n      } catch (error) {\n        console.error('Error creating offer:', error);\n      }\n    };\n\n    // Clean up on unmount\n    return () => {\n      var _ws$current4;\n      pc.close();\n      (_ws$current4 = ws.current) === null || _ws$current4 === void 0 ? void 0 : _ws$current4.close();\n    };\n  }, \"OD7bBpZva5O2jO+Puf00hKivP7c=\"), []), \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Video Call\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        gap: '1rem'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Local Video\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n          ref: localVideoRef,\n          autoPlay: true,\n          playsInline: true,\n          muted: true,\n          style: {\n            width: '300px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 99,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Remote Video\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n          ref: remoteVideoRef,\n          autoPlay: true,\n          playsInline: true,\n          style: {\n            width: '300px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 96,\n    columnNumber: 5\n  }, this);\n};\n_s2(VideoCall, \"rg3Bi1UVGjgM3fZiJ8p5CLXIJfo=\");\n_c = VideoCall;\nexport default VideoCall;\nvar _c;\n$RefreshReg$(_c, \"VideoCall\");","map":{"version":3,"names":["React","useEffect","useRef","useState","jsxDEV","_jsxDEV","VideoCall","_s2","_s","$RefreshSig$","localVideoRef","remoteVideoRef","peerConnection","setPeerConnection","ws","configuration","iceServers","urls","pc","RTCPeerConnection","ontrack","event","current","srcObject","streams","console","log","WebSocket","onmessage","messageEvent","data","JSON","parse","offer","_ws$current","setRemoteDescription","RTCSessionDescription","answer","createAnswer","setLocalDescription","send","stringify","ice","addIceCandidate","e","error","onicecandidate","candidate","_ws$current2","navigator","mediaDevices","getUserMedia","video","audio","then","stream","getTracks","forEach","track","addTrack","catch","onopen","_ws$current3","createOffer","_ws$current4","close","children","fileName","_jsxFileName","lineNumber","columnNumber","style","display","gap","ref","autoPlay","playsInline","muted","width","_c","$RefreshReg$"],"sources":["C:/Users/himat/OneDrive/desktop/aslproject/webrtc-asl/src/VideoCall.tsx"],"sourcesContent":["// src/VideoCall.tsx\r\nimport React, { useEffect, useRef, useState } from 'react';\r\n\r\nconst VideoCall: React.FC = () => {\r\n  const localVideoRef = useRef<HTMLVideoElement | null>(null);\r\n  const remoteVideoRef = useRef<HTMLVideoElement | null>(null);\r\n  const [peerConnection, setPeerConnection] = useState<RTCPeerConnection | null>(null);\r\n  const ws = useRef<WebSocket | null>(null);\r\n\r\n  useEffect(() => {\r\n    // Configure STUN server (using Google’s public STUN server)\r\n    const configuration = {\r\n      iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]\r\n    };\r\n\r\n    // Create RTCPeerConnection\r\n    const pc = new RTCPeerConnection(configuration);\r\n    setPeerConnection(pc);\r\n\r\n    // When a remote stream arrives, attach it to the remoteVideo element\r\n    pc.ontrack = (event) => {\r\n      if (remoteVideoRef.current) {\r\n        remoteVideoRef.current.srcObject = event.streams[0];\r\n      }\r\n    };\r\n\r\n    // Connect to the signaling server\r\n    //ws.current = new WebSocket('ws://localhost:8080');\r\n    useEffect(() => {\r\n        console.log('Creating WebSocket...');\r\n        ws.current = new WebSocket('ws://localhost:8080');\r\n        // ...\r\n      }, []);\r\n      \r\n    ws.current.onmessage = async (messageEvent) => {\r\n      const data = JSON.parse(messageEvent.data);\r\n      if (data.offer) {\r\n        // Received an offer from a remote peer\r\n        await pc.setRemoteDescription(new RTCSessionDescription(data.offer));\r\n        const answer = await pc.createAnswer();\r\n        await pc.setLocalDescription(answer);\r\n        ws.current?.send(JSON.stringify({ answer }));\r\n      } else if (data.answer) {\r\n        // Received answer to our offer\r\n        await pc.setRemoteDescription(new RTCSessionDescription(data.answer));\r\n      } else if (data.ice) {\r\n        // Received ICE candidate from remote peer\r\n        try {\r\n          await pc.addIceCandidate(data.ice);\r\n        } catch (e) {\r\n          console.error('Error adding ICE candidate', e);\r\n        }\r\n      }\r\n    };\r\n\r\n    // When a new ICE candidate is found, send it via signaling\r\n    pc.onicecandidate = (event) => {\r\n      if (event.candidate) {\r\n        ws.current?.send(JSON.stringify({ ice: event.candidate }));\r\n      }\r\n    };\r\n\r\n    // Get the local media stream and add it to the peer connection\r\n    navigator.mediaDevices.getUserMedia({ video: true, audio: true })\r\n      .then((stream) => {\r\n        if (localVideoRef.current) {\r\n          localVideoRef.current.srcObject = stream;\r\n        }\r\n        stream.getTracks().forEach((track) => {\r\n          pc.addTrack(track, stream);\r\n        });\r\n      })\r\n      .catch((error) => {\r\n        console.error('Error accessing media devices:', error);\r\n      });\r\n\r\n    // Once signaling connection is open, create an offer\r\n    ws.current.onopen = async () => {\r\n      try {\r\n        const offer = await pc.createOffer();\r\n        await pc.setLocalDescription(offer);\r\n        ws.current?.send(JSON.stringify({ offer }));\r\n      } catch (error) {\r\n        console.error('Error creating offer:', error);\r\n      }\r\n    };\r\n\r\n    // Clean up on unmount\r\n    return () => {\r\n      pc.close();\r\n      ws.current?.close();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div>\r\n      <h2>Video Call</h2>\r\n      <div style={{ display: 'flex', gap: '1rem' }}>\r\n        <div>\r\n          <h3>Local Video</h3>\r\n          <video ref={localVideoRef} autoPlay playsInline muted style={{ width: '300px' }} />\r\n        </div>\r\n        <div>\r\n          <h3>Remote Video</h3>\r\n          <video ref={remoteVideoRef} autoPlay playsInline style={{ width: '300px' }} />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VideoCall;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}